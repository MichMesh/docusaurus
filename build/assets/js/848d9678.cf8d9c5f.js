"use strict";(globalThis.webpackChunkmichmesh=globalThis.webpackChunkmichmesh||[]).push([[195],{4959:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Meshtastic/mqtt server","title":"Installation and configuration of the Mosquitto MQTT server","description":"This is based on a debian install, ubuntu should be similar.","source":"@site/docs/Meshtastic/mqtt server.md","sourceDirName":"Meshtastic","slug":"/Meshtastic/mqtt server","permalink":"/docs/Meshtastic/mqtt server","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"OTA Meshtastic Updates on Android","permalink":"/docs/Meshtastic/OTA_Meshtastic_Updates"},"next":{"title":"Reticulum","permalink":"/docs/Reticulum/"}}');var i=n(4848),o=n(8453);const r={},c="Installation and configuration of the Mosquitto MQTT server",l={},a=[];function d(e){const t={code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"installation-and-configuration-of-the-mosquitto-mqtt-server",children:"Installation and configuration of the Mosquitto MQTT server"})}),"\n",(0,i.jsx)(t.p,{children:"This is based on a debian install, ubuntu should be similar."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"sudo apt install mosquitto"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"sudo vim /etc/mosquitto/mosquitto.conf"})}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"pid_file /run/mosquitto/mosquitto.pid\n\nlog_dest topic\nlog_type information\nlog_type subscribe\nlog_type unsubscribe\n\nacl_file /etc/mosquitto/aclfile.conf\n\nlistener 8883\ncafile /etc/letsencrypt/live/ynos.us-0001/chain.pem\nkeyfile /etc/letsencrypt/live/ynos.us-0001/privkey.pem\ncertfile /etc/letsencrypt/live/ynos.us-0001/cert.pem\n\n\nlistener 1883\nallow_anonymous  false\npassword_file /etc/mosquitto/passwd\n\nconnection me-to-mesh\naddress mqtt.meshtastic.org:1883\nremote_username meshdev\nremote_password large4cats\ntopic msh/US/MI/# both\n\nconnection me-to-liam\naddress mqtt.meshtastic.liamcottle.net:1883\nremote_username uplink\nremote_password uplink\ntopic msh/US/MI out\n"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"sudo vim /etc/mosquitto/aclfile.conf"})}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'# This affects access control for clients with no username.\ntopic read $SYS/#\n\n# This only affects clients with username "testuser".\nuser testuser\ntopic readwrite test/#\n#topic read $SYS/#\n\nuser meshdev\ntopic readwrite msh/#\ntopic read $SYS/#\n\n# This affects all clients.\npattern write $SYS/broker/connection/%c/state\n'})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"sudo mosquitto_passwd -c meshdev /etc/mosquitto/passwd"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"password: large4cats"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"sudo systemctl enable mosquitto"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"sudo systemctl restart mosquitto"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"You will have to do a bit of a permissions dance to get certs working. I have it running with a letsencrypt cert, this is what I had to do."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["create a group called ",(0,i.jsx)(t.code,{children:"certreader"})]}),"\n",(0,i.jsxs)(t.li,{children:["change the group ownership of the /etc/letsencrypt/archive/ to certreader\n",(0,i.jsx)(t.code,{children:"sudo chgrp -R certreader /etc/letsencrypt/archive/$YOURCERTDIR"})]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>c});var s=n(6540);const i={},o=s.createContext(i);function r(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);